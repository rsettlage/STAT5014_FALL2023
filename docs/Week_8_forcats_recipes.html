<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Robert Settlage" />

<meta name="date" content="2022-10-26" />

<title>Lecture 8 - factors and recipes</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.0/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">STAT5014 Fall2023 website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Week_1_Introductions_Reproducible_Research_R.html">Week 1</a>
    </li>
    <li>
      <a href="Week_2_Reproducible_research_Git_Good_Programming_Practices.html">Week 2</a>
    </li>
    <li>
      <a href="Week_3_Websites_Github.html">Week 3</a>
    </li>
    <li>
      <a href="Week_4_Plots_using_ggplot2_plotly_more.html">Week 4</a>
    </li>
    <li>
      <a href="Week_5_matrix_vector_math.html">Week 5</a>
    </li>
    <li>
      <a href="Week_6_wrangling_munging_tidying.html">Week 6</a>
    </li>
    <li>
      <a href="Week_7_importing_data.html">Week 7</a>
    </li>
    <li>
      <a href="Week_8_forcats_recipes.html">Week 8</a>
    </li>
    <li>
      <a href="Week_9_apply_mutate_map.html">Week 9</a>
    </li>
    <li>
      <a href="Week_10_dashboards_reports_automation.html">Week 10</a>
    </li>
    <li>
      <a href="Week_11_AIML.html">Week 11</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Homework
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Week_1_homework_1.html">Homework 1</a>
    </li>
    <li>
      <a href="Week_3_homework_2.html">Homework 2</a>
    </li>
    <li>
      <a href="Week_6_homework_3.html">Homework 3</a>
    </li>
    <li>
      <a href="https://rsettlage.github.io/deeplearning/2022-11-04-fun-with-h2o/">Project 1</a>
    </li>
    <li>
      <a href="Project-skeleton.Rmd">Project Skeleton</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Setup
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="submittinghomework.html">Submitting Homework</a>
    </li>
    <li>
      <a href="SampleHomework.html">Sample Homework</a>
    </li>
    <li>
      <a href="gitconf.html">Git Config</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rsettlage/STAT5014_Fall2023">
    <span class="fa fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lecture 8 - factors and recipes</h1>
<h4 class="author">Robert Settlage</h4>
<h4 class="date">2022-10-26</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
workflowr <span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span>
</a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2023-10-11
</p>
<p>
<strong>Checks:</strong> <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 7
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> 0
</p>
<p>
<strong>Knit directory:</strong> <code>STAT5014_FALL2023/</code> <span
class="glyphicon glyphicon-question-sign" aria-hidden="true"
title="This is the local directory in which the code in this file was executed.">
</span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a>
analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version
1.7.0). The <em>Checks</em> tab describes the reproducibility checks
that were applied when the results were created. The <em>Past
versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date
</a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git
repository, you know the exact version of the code that produced these
results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the
global environment can affect the analysis in your R Markdown file in
unknown ways. For reproduciblity it’s best to always run the code in an
empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20210816code">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Seed:</strong>
<code>set.seed(20210816)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20210816code"
class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20210816)</code> was run prior to running
the code in the R Markdown file. Setting a seed ensures that any results
that rely on randomness, e.g. subsampling or permutations, are
reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Session information:</strong>
recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package
versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongnone">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Cache:</strong> none </a>
</p>
</div>
<div id="strongCachestrongnone" class="panel-collapse collapse">
<div class="panel-body">
<p>Nice! There were no cached chunks for this analysis, so you can be
confident that you successfully produced the results during this
run.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr
project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomrsettlageSTAT5014FALL2023tree20785ea27659e2748ffe9d9c5bffb19ac3690973targetblank20785eaa">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Repository version:</strong>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/tree/20785ea27659e2748ffe9d9c5bffb19ac3690973" target="_blank">20785ea</a>
</a>
</p>
</div>
<div
id="strongRepositoryversionstrongahrefhttpsgithubcomrsettlageSTAT5014FALL2023tree20785ea27659e2748ffe9d9c5bffb19ac3690973targetblank20785eaa"
class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development
and connecting the code version to the results is critical for
reproducibility.
</p>
<p>
The results in this page were generated with repository version
<a href="https://github.com/rsettlage/STAT5014_FALL2023/tree/20785ea27659e2748ffe9d9c5bffb19ac3690973" target="_blank">20785ea</a>.
See the <em>Past versions</em> tab to see a history of the changes made
to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for
the analysis have been committed to Git prior to generating the results
(you can use <code>wflow_publish</code> or
<code>wflow_git_commit</code>). workflowr only checks the R Markdown
file, but you know if there are other scripts or data files that it
depends on. Below is the status of the Git repository when the results
were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rproj.user/
    Ignored:    analysis/.Rhistory

Untracked files:
    Untracked:  Week4_part1.mp4
    Untracked:  Week4_part2.mp4
    Untracked:  Week4_part3.mp4
    Untracked:  analysis/Week_6_homework_3.Rmd
    Untracked:  week4_part4.mp4

Unstaged changes:
    Modified:   analysis/Week_4_Plots_using_ggplot2_plotly_more.Rmd
    Modified:   analysis/Week_5_matrix_vector_math.Rmd
    Modified:   analysis/Week_6_wrangling_munging_tidying.Rmd
    Modified:   analysis/Week_7_importing_data.Rmd
    Modified:   analysis/_site.yml
    Modified:   girder_raw.RDS
    Modified:   sensory_raw.RDS

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not
included in this status report because it is ok for generated content to
have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were
made to the R Markdown
(<code>analysis/Week_8_forcats_recipes.Rmd</code>) and HTML
(<code>docs/Week_8_forcats_recipes.html</code>) files. If you’ve
configured a remote Git repository (see <code>?wflow_git_remote</code>),
click on the hyperlinks in the table below to view the files as they
were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/a2ca484181f0ea6144fcb15f120ca582dce11c35/analysis/Week_8_forcats_recipes.Rmd" target="_blank">a2ca484</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
<td>
push all
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="last-time" class="section level1">
<h1>Last time:</h1>
<ul>
<li>Importing data</li>
</ul>
<p>(my)sql, excel, json, plain text, yaml, web scraping</p>
<p>As usual, there’s a library for that …</p>
<p>The functions I typically use are:</p>
<p>plain text, csv, tab, etc - fread (data.table)<br />
rectangular – read_delim (readr)<br />
excel - read_excel (readxl)<br />
json - fromJSON (rjson)<br />
yaml - read_yaml (yaml)<br />
sql - bit more complicated, but ….<br />
<a
href="https://datacarpentry.org/R-ecology-lesson/05-r-and-databases.html"
class="uri">https://datacarpentry.org/R-ecology-lesson/05-r-and-databases.html</a></p>
<div id="plain-text" class="section level2">
<h2>Plain text</h2>
<p>These can be in many formats that may include single delimiters (eg
csv, tsv, etc), multiple delimiters, a fixed with, garbled with a
missing field/delimiter, or have incompatible line endings (Mac vs
Windows).</p>
<p>Why don’t I prefer read.csv/delim?</p>
<ol style="list-style-type: decimal">
<li>fread starts with a good guess at what my seperator is going to be
“[,;:]”<br />
</li>
<li>read_delim/fread are very fast, they sample the file and then set
the column types<br />
</li>
<li>fread allows me to add a bash command that is run inline with the
reading<br />
</li>
<li>readr functions capture the errors and attach them to the returned
object as problems<br />
</li>
<li>readr gives me a summary of what it found<br />
</li>
<li>fread/readr allows me to read directly from compressed files<br />
</li>
<li>fread/readr allow me to read from a remote file<br />
</li>
<li>both have a lot of other useful options: skip, comment, trim_ws,
select, sep2, fill</li>
</ol>
<p>Examples:</p>
<pre class="r"><code>library(dplyr)
library(readr)
library(data.table)

# remote file
read_csv(&quot;https://github.com/tidyverse/readr/raw/main/inst/extdata/mtcars.csv&quot;)

# use inline bash commands
# could do this operation with the select argument, but the idea translates into better stuff  
readr_example(&quot;mtcars.csv&quot;)
fread(&quot;awk -F&#39;,&#39; &#39;{print $1, $4}&#39; /Users/rsettlag/R/readr/extdata/mtcars.csv&quot;)


# problems example:
y &lt;- &quot;x\n1\n2\nb&quot; %&gt;% read_csv(col_types = list(col_double()))

problems(y)</code></pre>
<p>python:</p>
<pre class="python"><code>import pandas as pd

df = pd.read_csv(r&#39;/Users/rsettlag/R/readr/extdata/mtcars.csv&#39;)   
print(df)</code></pre>
</div>
</div>
<div id="todays-agenda" class="section level1">
<h1>Today’s Agenda</h1>
<ul>
<li>Categorical data<br />
</li>
<li>Recipes</li>
</ul>
<div id="categorical-data" class="section level2">
<h2>Categorical data</h2>
<p>Categorical data is best described as grouped data. This data has no
intrinsic place and order (or scale) on the number line. Inclusive in
this is nominal (no order) and ordinal (no scale) data. For example:</p>
<ul>
<li>yes/no<br />
</li>
<li>eye color<br />
</li>
<li>country<br />
</li>
<li>satisfaction rating from 1-5 (least to most)<br />
</li>
<li>income as high/med/low</li>
</ul>
<div id="converting-continuous-data-into-categorical"
class="section level3">
<h3>Converting continuous data into categorical</h3>
<p>Sometimes, it is advantageous to lump continuous data into groups.
For instance, you may have a date variable but are only interested in
year, or weight and only interested in a high/med/low summary.</p>
<p>Let’s play with the penguin data and see what we see:</p>
<pre class="r"><code>penguins %&gt;%
  glimpse()</code></pre>
<pre><code>Rows: 344
Columns: 8
$ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…
$ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…
$ bill_length_mm    &lt;dbl&gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …
$ bill_depth_mm     &lt;dbl&gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …
$ flipper_length_mm &lt;int&gt; 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…
$ body_mass_g       &lt;int&gt; 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …
$ sex               &lt;fct&gt; male, female, female, NA, female, male, female, male…
$ year              &lt;int&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…</code></pre>
<pre class="r"><code>penguins %&gt;%
  filter(complete.cases(.)) %&gt;%
  ggplot(aes(x=sex, y=bill_length_mm)) +
  geom_violin() +
  geom_jitter(aes(color=island)) +
  facet_wrap(~species)</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/palmer_category-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-palmer_category-1">
Past versions of palmer_category-1.png
</button>
</p>
<div id="fig-palmer_category-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/palmer_category-1.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>penguins %&gt;% 
  filter(complete.cases(.)) %&gt;%
  ggplot(aes(x=bill_length_mm, y=body_mass_g)) +
  geom_point(aes(color=sex)) + 
  facet_grid(~island)</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/palmer_category-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-palmer_category-2">
Past versions of palmer_category-2.png
</button>
</p>
<div id="fig-palmer_category-2" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/palmer_category-2.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>penguins %&gt;% 
  filter(complete.cases(.)) %&gt;%
  ggplot(aes(x=bill_depth_mm, y=body_mass_g)) +
  geom_point(aes(color=sex, shape=species)) + 
  facet_grid(~island)</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/palmer_category-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-palmer_category-3">
Past versions of palmer_category-3.png
</button>
</p>
<div id="fig-palmer_category-3" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/palmer_category-3.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>penguins %&gt;% 
  filter(complete.cases(.)) %&gt;%
  mutate(bill_volume = bill_length_mm * bill_depth_mm^2) %&gt;%
  ggplot(aes(x=bill_volume, y=body_mass_g)) +
  geom_point(aes(color=sex, shape=species)) + 
  facet_grid(~island)</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/palmer_category-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-palmer_category-4">
Past versions of palmer_category-4.png
</button>
</p>
<div id="fig-palmer_category-4" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/palmer_category-4.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>penguins_new &lt;- penguins %&gt;%
  filter(complete.cases(.)) %&gt;%
  mutate(bill_volume = bill_length_mm * bill_depth_mm^2) %&gt;%
  mutate(bill_volume_quartile = case_when(
    bill_volume &lt; quantile(bill_volume, prob=c(0.25, 0.5, 0.75))[1] ~ &quot;small&quot;,
    bill_volume &lt; quantile(bill_volume, prob=c(0.25, 0.5, 0.75))[2] ~ &quot;small-med&quot;,
    bill_volume &lt; quantile(bill_volume, prob=c(0.25, 0.5, 0.75))[3] ~ &quot;med-large&quot;,
    TRUE ~ &quot;large&quot;
  )) 

penguins_new %&gt;%
  ggplot(aes(x=sex, y=body_mass_g)) +
  geom_violin(aes(color=species)) + 
  facet_grid(cols=vars(bill_volume_quartile), rows=vars(island))</code></pre>
<pre><code>Warning: Groups with fewer than two data points have been dropped.</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/palmer_category-5.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-palmer_category-5">
Past versions of palmer_category-5.png
</button>
</p>
<div id="fig-palmer_category-5" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/palmer_category-5.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code>skim(penguins_new)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">penguins_new</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">333</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">10</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">factor</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">6</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table style="width:100%;">
<colgroup>
<col width="26%" />
<col width="12%" />
<col width="17%" />
<col width="5%" />
<col width="5%" />
<col width="7%" />
<col width="11%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bill_volume_quartile</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<colgroup>
<col width="16%" />
<col width="12%" />
<col width="16%" />
<col width="9%" />
<col width="10%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">species</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">Ade: 146, Gen: 119, Chi: 68</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">Bis: 163, Dre: 123, Tor: 47</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">mal: 168, fem: 165</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col width="16%" />
<col width="9%" />
<col width="12%" />
<col width="8%" />
<col width="7%" />
<col width="7%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bill_length_mm</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">43.99</td>
<td align="right">5.47</td>
<td align="right">32.10</td>
<td align="right">39.50</td>
<td align="right">44.50</td>
<td align="right">48.60</td>
<td align="right">59.60</td>
<td align="left">▃▇▇▆▁</td>
</tr>
<tr class="even">
<td align="left">bill_depth_mm</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">17.16</td>
<td align="right">1.97</td>
<td align="right">13.10</td>
<td align="right">15.60</td>
<td align="right">17.30</td>
<td align="right">18.70</td>
<td align="right">21.50</td>
<td align="left">▅▆▇▇▂</td>
</tr>
<tr class="odd">
<td align="left">flipper_length_mm</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">200.97</td>
<td align="right">14.02</td>
<td align="right">172.00</td>
<td align="right">190.00</td>
<td align="right">197.00</td>
<td align="right">213.00</td>
<td align="right">231.00</td>
<td align="left">▂▇▃▅▃</td>
</tr>
<tr class="even">
<td align="left">body_mass_g</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4207.06</td>
<td align="right">805.22</td>
<td align="right">2700.00</td>
<td align="right">3550.00</td>
<td align="right">4050.00</td>
<td align="right">4775.00</td>
<td align="right">6300.00</td>
<td align="left">▃▇▅▃▂</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2008.04</td>
<td align="right">0.81</td>
<td align="right">2007.00</td>
<td align="right">2007.00</td>
<td align="right">2008.00</td>
<td align="right">2009.00</td>
<td align="right">2009.00</td>
<td align="left">▇▁▇▁▇</td>
</tr>
<tr class="even">
<td align="left">bill_volume</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13050.53</td>
<td align="right">3149.32</td>
<td align="right">7362.07</td>
<td align="right">10754.86</td>
<td align="right">12701.29</td>
<td align="right">14764.74</td>
<td align="right">23449.09</td>
<td align="left">▅▇▅▂▁</td>
</tr>
</tbody>
</table>
<pre class="r"><code>penguins_new &lt;- penguins_new %&gt;%
  mutate(bill_volume_buckets = case_when(
    bill_volume &gt; quantile(bill_volume, prob=c(0.9, 0.8, 0.7, 0.6, 0.5, 0.4))[1] ~ &quot;Q9&quot;,
    bill_volume &gt; quantile(bill_volume, prob=c(0.9, 0.8, 0.7, 0.6, 0.5, 0.4))[2] ~ &quot;Q8&quot;,
    bill_volume &gt; quantile(bill_volume, prob=c(0.9, 0.8, 0.7, 0.6, 0.5, 0.4))[3] ~ &quot;Q7&quot;,
    bill_volume &gt; quantile(bill_volume, prob=c(0.9, 0.8, 0.7, 0.6, 0.5, 0.4))[4] ~ &quot;Q6&quot;,
    bill_volume &gt; quantile(bill_volume, prob=c(0.9, 0.8, 0.7, 0.6, 0.5, 0.4))[5] ~ &quot;Q5&quot;,
    TRUE ~ &quot;other&quot;
  )) 

penguins_new %&gt;%
  ggplot(aes(x=sex, y=body_mass_g)) +
  geom_violin(aes(color=species)) + 
  facet_grid(cols=vars(bill_volume_buckets), rows=vars(island))</code></pre>
<pre><code>Warning: Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/palmer_category-6.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-palmer_category-6">
Past versions of palmer_category-6.png
</button>
</p>
<div id="fig-palmer_category-6" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/palmer_category-6.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="factors" class="section level3">
<h3>factors</h3>
<p>What ggplot is doing under the hood for the text based variables is
using as.factor to convert from text to a factor. We can test and change
that. A handy alternative to <code>as.factor</code> is
<code>as_factor</code> tidyverse alternative from
<code>forcats</code>.</p>
<pre class="r"><code># check out the factor assignments and levels
as.factor(penguins_new$bill_volume_buckets)</code></pre>
<pre><code>  [1] Q6    other Q5    Q6    Q8    other Q7    Q5    Q8    Q8    other Q6   
 [13] Q9    other Q9    other Q5    Q5    other other other Q6    Q5    Q5   
 [25] Q7    other other other Q7    other Q8    Q8    Q7    Q6    Q7    other
 [37] Q6    other Q8    other Q6    Q7    other Q9    other Q7    other Q8   
 [49] other Q7    other Q7    other Q6    other Q9    other Q6    other Q6   
 [61] other Q7    other Q8    other Q6    other Q8    other Q7    other Q6   
 [73] other Q7    other Q5    Q5    Q5    other Q8    Q6    Q5    Q6    Q6   
 [85] other Q6    other Q5    other Q7    Q5    Q6    other Q7    other Q8   
 [97] other Q7    Q5    Q6    other Q7    other Q8    other Q9    other Q8   
[109] Q8    Q7    other Q8    other Q7    other Q7    other Q6    other Q7   
[121] other Q6    other Q7    other Q8    other Q5    other other other Q8   
[133] other Q5    other other other other other Q6    Q6    other other other
[145] other Q6    other Q5    other other other other other other other other
[157] other other other other other other other other other other other other
[169] other other other other other other other other other other Q8    other
[181] Q5    other Q5    other other other other other other Q5    other other
[193] Q5    other other other other other other other other other other other
[205] other other other other Q5    other Q6    Q5    other other other other
[217] other other other other other Q6    other other other Q5    other other
[229] other Q7    other other other Q7    other Q7    other Q5    other other
[241] other other other Q6    other Q8    other other other other Q5    other
[253] other other other other Q6    other Q6    Q5    other other other other
[265] Q5    Q7    Q9    Q9    Q8    Q9    Q7    Q7    Q8    Q8    Q9    Q7   
[277] Q9    Q6    Q8    Q6    Q9    Q9    Q9    Q8    Q8    other Q7    other
[289] Q9    Q7    Q9    Q8    Q9    Q7    Q9    other Q9    other Q9    Q8   
[301] Q6    Q8    Q9    Q5    Q9    Q9    Q6    Q9    Q5    Q8    Q8    Q8   
[313] Q9    Q9    Q7    Q5    Q9    Q6    Q9    Q5    Q9    other Q9    Q9   
[325] Q8    Q9    Q5    Q5    Q9    Q7    Q8    Q9    Q9   
Levels: other Q5 Q6 Q7 Q8 Q9</code></pre>
<pre class="r"><code>levels(as.factor(penguins_new$bill_volume_buckets))</code></pre>
<pre><code>[1] &quot;other&quot; &quot;Q5&quot;    &quot;Q6&quot;    &quot;Q7&quot;    &quot;Q8&quot;    &quot;Q9&quot;   </code></pre>
<pre class="r"><code>as.numeric(as.factor(penguins_new$bill_volume_buckets))</code></pre>
<pre><code>  [1] 3 1 2 3 5 1 4 2 5 5 1 3 6 1 6 1 2 2 1 1 1 3 2 2 4 1 1 1 4 1 5 5 4 3 4 1 3
 [38] 1 5 1 3 4 1 6 1 4 1 5 1 4 1 4 1 3 1 6 1 3 1 3 1 4 1 5 1 3 1 5 1 4 1 3 1 4
 [75] 1 2 2 2 1 5 3 2 3 3 1 3 1 2 1 4 2 3 1 4 1 5 1 4 2 3 1 4 1 5 1 6 1 5 5 4 1
[112] 5 1 4 1 4 1 3 1 4 1 3 1 4 1 5 1 2 1 1 1 5 1 2 1 1 1 1 1 3 3 1 1 1 1 3 1 2
[149] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 5 1 2 1 2 1 1
[186] 1 1 1 1 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 3 2 1 1 1 1 1 1 1 1 1 3
[223] 1 1 1 2 1 1 1 4 1 1 1 4 1 4 1 2 1 1 1 1 1 3 1 5 1 1 1 1 2 1 1 1 1 1 3 1 3
[260] 2 1 1 1 1 2 4 6 6 5 6 4 4 5 5 6 4 6 3 5 3 6 6 6 5 5 1 4 1 6 4 6 5 6 4 6 1
[297] 6 1 6 5 3 5 6 2 6 6 3 6 2 5 5 5 6 6 4 2 6 3 6 2 6 1 6 6 5 6 2 2 6 4 5 6 6</code></pre>
<pre class="r"><code># we can arrange by the variable, does it change the factor order?
penguins_new &lt;- penguins_new %&gt;%
  arrange(desc(bill_volume_buckets)) 
as.factor(penguins_new$bill_volume_buckets)</code></pre>
<pre><code>  [1] other other other other other other other other other other other other
 [13] other other other other other other other other other other other other
 [25] other other other other other other other other other other other other
 [37] other other other other other other other other other other other other
 [49] other other other other other other other other other other other other
 [61] other other other other other other other other other other other other
 [73] other other other other other other other other other other other other
 [85] other other other other other other other other other other other other
 [97] other other other other other other other other other other other other
[109] other other other other other other other other other other other other
[121] other other other other other other other other other other other other
[133] other other other other other other other other other other other other
[145] other other other other other other other other other other other other
[157] other other other other other other other other other other other Q9   
[169] Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9   
[181] Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9   
[193] Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q9    Q8    Q8    Q8   
[205] Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8   
[217] Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8    Q8   
[229] Q8    Q8    Q8    Q8    Q8    Q8    Q7    Q7    Q7    Q7    Q7    Q7   
[241] Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7   
[253] Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7    Q7   
[265] Q7    Q7    Q7    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6   
[277] Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6   
[289] Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6    Q6   
[301] Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5   
[313] Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5   
[325] Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5    Q5   
Levels: other Q5 Q6 Q7 Q8 Q9</code></pre>
<pre class="r"><code>penguins_new %&gt;%
  ggplot(aes(x=sex, y=body_mass_g)) +
  geom_violin(aes(color=species)) + 
  facet_grid(cols=vars(bill_volume_buckets), rows=vars(island))</code></pre>
<pre><code>Warning: Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/factor_example-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-factor_example-1">
Past versions of factor_example-1.png
</button>
</p>
<div id="fig-factor_example-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/factor_example-1.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># what does as_factor do differently?
penguins_new &lt;- penguins_new %&gt;%
  mutate(bill_volume_buckets_fct = bill_volume_buckets %&gt;% as_factor())

penguins_new %&gt;%
  ggplot(aes(x=sex, y=body_mass_g)) +
  geom_violin(aes(color=species)) + 
  facet_grid(cols=vars(bill_volume_buckets_fct), rows=vars(island))</code></pre>
<pre><code>Warning: Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/factor_example-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-factor_example-2">
Past versions of factor_example-2.png
</button>
</p>
<div id="fig-factor_example-2" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/factor_example-2.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># to reverse the factor levels, use fct_rev
penguins_new &lt;- penguins_new %&gt;%
  mutate(bill_volume_buckets_fct2 = bill_volume_buckets_fct %&gt;% as_factor() %&gt;% fct_rev())

# what if we want to re-order with a non sortable order?
penguins_new &lt;- penguins_new %&gt;%
  mutate(bill_volume_buckets_fct3 = bill_volume_buckets_fct2 %&gt;% as_factor() %&gt;% fct_relevel(&quot;other&quot;, after=Inf))

penguins_new %&gt;%
  ggplot(aes(x=sex, y=body_mass_g)) +
  geom_violin(aes(color=species)) + 
  facet_grid(cols=vars(bill_volume_buckets_fct3), rows=vars(island))</code></pre>
<pre><code>Warning: Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.
Groups with fewer than two data points have been dropped.</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/factor_example-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-factor_example-3">
Past versions of factor_example-3.png
</button>
</p>
<div id="fig-factor_example-3" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/factor_example-3.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="what-about-for-a-model" class="section level3">
<h3>What about for a model?</h3>
<p>What you need for a model is a “one-hot” encoded variable. It creates
a new column for each unique value of the categorical variable. Each of
these columns are binary with values 1 or 0 depending on whether the
value of the variable is equal to the unique value being encoded by this
column. The R function lm (through <code>model.matrix</code>) does this
for us.</p>
<pre class="r"><code># in this, what is does the intercept represent?
model.matrix(bill_length_mm~sex+bill_volume, penguins_new)</code></pre>
<pre><code>    (Intercept) sexmale bill_volume
1             1       0   11959.020
2             1       0   12325.076
3             1       0   11596.344
4             1       0   11646.464
5             1       0   12658.842
6             1       1   12514.702
7             1       1   11478.592
8             1       0   12609.513
9             1       0   11016.155
10            1       1   12187.092
11            1       0   12515.180
12            1       0   10519.600
13            1       0   11826.000
14            1       0   12321.000
15            1       0   10567.570
16            1       0   11534.760
17            1       0   12406.284
18            1       0   11214.350
19            1       0   11302.545
20            1       0   11943.750
21            1       0   10057.940
22            1       0   10196.277
23            1       0   10866.400
24            1       0   10643.724
25            1       0    9316.620
26            1       0    9892.604
27            1       0   12093.500
28            1       0   11715.264
29            1       0   10871.875
30            1       0   11543.616
31            1       0    9383.402
32            1       0   10236.064
33            1       0   11818.132
34            1       0   11566.800
35            1       0    9941.940
36            1       0   10834.298
37            1       0    8579.851
38            1       0   11214.350
39            1       0    9651.200
40            1       0   11419.424
41            1       0   11010.900
42            1       0   10372.725
43            1       0   12437.613
44            1       0   11155.400
45            1       0   10317.300
46            1       0   10709.408
47            1       0   11617.800
48            1       0    8898.912
49            1       0   12018.688
50            1       0   11403.990
51            1       0   12335.785
52            1       0   12594.800
53            1       0   11801.856
54            1       1   12586.875
55            1       0   10902.500
56            1       0   10073.250
57            1       0   11754.882
58            1       1   12011.104
59            1       0    7712.025
60            1       1   11762.300
61            1       0   10527.552
62            1       0   12391.296
63            1       0   11406.240
64            1       1   12383.658
65            1       0   10526.760
66            1       0    8032.464
67            1       0    9682.047
68            1       1   11552.000
69            1       1   10007.900
70            1       0    8474.625
71            1       0    9677.464
72            1       1   10932.003
73            1       0    7774.948
74            1       1   11099.088
75            1       0    7676.521
76            1       1   12701.290
77            1       0    8539.895
78            1       1   10316.944
79            1       0    9762.728
80            1       1   12151.957
81            1       0    7654.500
82            1       1   11367.168
83            1       0    9713.550
84            1       1   11104.087
85            1       1   10265.398
86            1       0    9482.275
87            1       0    9776.625
88            1       1   11558.332
89            1       0    7362.069
90            1       1   10511.261
91            1       1   10755.000
92            1       0    9856.418
93            1       1   11704.500
94            1       1   11072.457
95            1       0    8630.192
96            1       0    9482.275
97            1       0   10754.864
98            1       0    7995.594
99            1       0    8138.240
100           1       1   12004.063
101           1       0    8014.363
102           1       1   12697.600
103           1       0    8502.357
104           1       1   11160.000
105           1       0    8423.956
106           1       0    8791.055
107           1       0    7942.361
108           1       1   11283.728
109           1       0    9396.424
110           1       1    9642.285
111           1       0    9351.936
112           1       1   11272.500
113           1       0    9642.240
114           1       1   10672.200
115           1       0    8462.598
116           1       1   10237.500
117           1       0    9082.800
118           1       1   11798.136
119           1       0    8626.932
120           1       1   10256.862
121           1       0    8829.697
122           1       0    9235.112
123           1       0    8771.340
124           1       1   11407.500
125           1       0   10732.500
126           1       1   11291.904
127           1       1   11729.952
128           1       0   10185.360
129           1       0   10440.000
130           1       1   12441.600
131           1       0    9577.900
132           1       0    8607.888
133           1       1   12156.992
134           1       0   10323.275
135           1       0   10103.784
136           1       1   12640.500
137           1       0    8550.756
138           1       0    8999.424
139           1       1   10344.132
140           1       0    9310.000
141           1       0   10687.500
142           1       0    9566.375
143           1       0    9616.005
144           1       1   12521.692
145           1       1   12332.216
146           1       0    9997.204
147           1       0   10036.224
148           1       0   10912.500
149           1       0   11339.800
150           1       1   11047.500
151           1       1   12131.028
152           1       0    9010.953
153           1       0    8486.800
154           1       1   10967.281
155           1       0   11667.520
156           1       1   12589.938
157           1       0   10050.240
158           1       0    9185.022
159           1       0    8858.968
160           1       0    9570.132
161           1       1   12423.096
162           1       0    9900.608
163           1       0   12689.896
164           1       0   11904.192
165           1       0   11270.404
166           1       0   11852.825
167           1       0   12455.312
168           1       1   18210.825
169           1       1   21263.500
170           1       1   19011.312
171           1       1   18387.173
172           1       1   18791.304
173           1       1   19012.500
174           1       1   18911.232
175           1       1   20660.508
176           1       1   20315.313
177           1       1   21305.053
178           1       1   19400.080
179           1       1   20120.000
180           1       0   18376.720
181           1       1   19043.816
182           1       1   18772.000
183           1       1   17869.500
184           1       1   21120.000
185           1       1   23449.088
186           1       1   18025.440
187           1       1   22281.480
188           1       1   21186.535
189           1       1   18632.250
190           1       1   18568.829
191           1       1   18823.840
192           1       1   18009.035
193           1       1   18555.400
194           1       1   19676.163
195           1       1   18449.568
196           1       1   19523.293
197           1       1   17742.688
198           1       1   19734.975
199           1       1   21875.832
200           1       1   18338.800
201           1       0   17554.438
202           1       1   16677.348
203           1       1   17348.384
204           1       1   15404.266
205           1       1   17452.232
206           1       1   15520.000
207           1       1   17114.769
208           1       1   15970.500
209           1       1   15731.848
210           1       1   16360.218
211           1       1   17019.317
212           1       1   16400.000
213           1       1   15595.200
214           1       1   16046.550
215           1       0   16968.204
216           1       1   15675.325
217           1       1   15888.384
218           1       1   16241.202
219           1       1   17224.400
220           1       1   16155.100
221           1       0   15875.926
222           1       1   16992.612
223           1       0   16431.660
224           1       1   17035.720
225           1       0   16052.544
226           1       1   16297.008
227           1       0   17097.280
228           1       1   17194.212
229           1       0   15940.764
230           1       0   16308.869
231           1       1   17386.300
232           1       0   16052.541
233           1       0   17162.016
234           1       1   16429.504
235           1       1   15059.072
236           1       1   14467.005
237           1       1   14609.889
238           1       0   14442.950
239           1       1   14519.438
240           1       1   14837.100
241           1       1   14324.121
242           1       1   14322.744
243           1       1   14349.664
244           1       1   14993.691
245           1       1   14648.300
246           1       1   15358.501
247           1       1   14574.168
248           1       1   14785.200
249           1       1   15120.000
250           1       1   15280.000
251           1       1   14299.803
252           1       1   14218.956
253           1       1   14779.908
254           1       1   14656.600
255           1       1   14288.400
256           1       1   15203.932
257           1       1   15056.900
258           1       1   15263.802
259           1       0   14899.065
260           1       0   14321.168
261           1       0   15270.164
262           1       0   14764.744
263           1       1   14853.125
264           1       0   14963.147
265           1       0   14701.376
266           1       0   14904.642
267           1       0   14251.035
268           1       1   13672.879
269           1       0   13670.383
270           1       0   13970.700
271           1       1   14045.976
272           1       0   14005.624
273           1       1   13813.248
274           1       1   13996.224
275           1       1   13716.856
276           1       1   13613.964
277           1       1   13478.400
278           1       1   13440.832
279           1       1   14000.592
280           1       1   13803.075
281           1       1   14118.912
282           1       0   13748.816
283           1       1   13464.771
284           1       1   13792.675
285           1       1   14181.237
286           1       1   14169.150
287           1       1   13897.935
288           1       1   13637.910
289           1       1   13561.632
290           1       1   14203.375
291           1       1   14055.552
292           1       1   13576.759
293           1       1   13911.975
294           1       1   13683.035
295           1       1   14105.600
296           1       0   14066.630
297           1       0   13421.619
298           1       0   13406.400
299           1       0   14148.750
300           1       0   13677.553
301           1       0   13057.200
302           1       0   12731.136
303           1       1   13183.313
304           1       0   13234.176
305           1       0   12976.605
306           1       0   13111.884
307           1       1   13288.704
308           1       0   12971.248
309           1       1   13210.236
310           1       0   12765.924
311           1       1   12973.356
312           1       0   13181.076
313           1       0   13111.884
314           1       1   12834.375
315           1       1   12720.277
316           1       1   13284.500
317           1       1   12859.396
318           1       1   13288.476
319           1       1   12766.905
320           1       1   12766.905
321           1       1   13384.407
322           1       1   12990.780
323           1       1   12776.400
324           1       1   12830.895
325           1       1   13330.776
326           1       1   12807.072
327           1       1   12934.579
328           1       0   12923.764
329           1       0   13149.500
330           1       0   12936.976
331           1       0   12719.825
332           1       0   12741.300
333           1       0   13207.300
attr(,&quot;assign&quot;)
[1] 0 1 2
attr(,&quot;contrasts&quot;)
attr(,&quot;contrasts&quot;)$sex
[1] &quot;contr.treatment&quot;</code></pre>
<pre class="r"><code># if we just wanted the sex and species encodings
model.matrix(~sex+species+0, penguins_new)</code></pre>
<pre><code>    sexfemale sexmale speciesChinstrap speciesGentoo
1           1       0                0             0
2           1       0                0             0
3           1       0                0             0
4           1       0                0             0
5           1       0                0             0
6           0       1                0             0
7           0       1                0             0
8           1       0                0             0
9           1       0                0             0
10          0       1                0             0
11          1       0                0             0
12          1       0                0             0
13          1       0                0             0
14          1       0                0             0
15          1       0                0             0
16          1       0                0             0
17          1       0                0             0
18          1       0                0             0
19          1       0                0             0
20          1       0                0             0
21          1       0                0             0
22          1       0                0             0
23          1       0                0             0
24          1       0                0             0
25          1       0                0             0
26          1       0                0             0
27          1       0                0             0
28          1       0                0             0
29          1       0                0             0
30          1       0                0             0
31          1       0                0             0
32          1       0                0             0
33          1       0                0             0
34          1       0                0             0
35          1       0                0             0
36          1       0                0             0
37          1       0                0             0
38          1       0                0             0
39          1       0                0             0
40          1       0                0             0
41          1       0                0             0
42          1       0                0             0
43          1       0                0             0
44          1       0                0             0
45          1       0                0             0
46          1       0                0             0
47          1       0                0             0
48          1       0                0             0
49          1       0                0             0
50          1       0                0             0
51          1       0                0             0
52          1       0                0             0
53          1       0                0             0
54          0       1                0             0
55          1       0                0             0
56          1       0                0             0
57          1       0                0             0
58          0       1                0             0
59          1       0                0             0
60          0       1                0             0
61          1       0                0             0
62          1       0                0             0
63          1       0                0             0
64          0       1                0             0
65          1       0                0             0
66          1       0                0             1
67          1       0                0             1
68          0       1                0             1
69          0       1                0             1
70          1       0                0             1
71          1       0                0             1
72          0       1                0             1
73          1       0                0             1
74          0       1                0             1
75          1       0                0             1
76          0       1                0             1
77          1       0                0             1
78          0       1                0             1
79          1       0                0             1
80          0       1                0             1
81          1       0                0             1
82          0       1                0             1
83          1       0                0             1
84          0       1                0             1
85          0       1                0             1
86          1       0                0             1
87          1       0                0             1
88          0       1                0             1
89          1       0                0             1
90          0       1                0             1
91          0       1                0             1
92          1       0                0             1
93          0       1                0             1
94          0       1                0             1
95          1       0                0             1
96          1       0                0             1
97          1       0                0             1
98          1       0                0             1
99          1       0                0             1
100         0       1                0             1
101         1       0                0             1
102         0       1                0             1
103         1       0                0             1
104         0       1                0             1
105         1       0                0             1
106         1       0                0             1
107         1       0                0             1
108         0       1                0             1
109         1       0                0             1
110         0       1                0             1
111         1       0                0             1
112         0       1                0             1
113         1       0                0             1
114         0       1                0             1
115         1       0                0             1
116         0       1                0             1
117         1       0                0             1
118         0       1                0             1
119         1       0                0             1
120         0       1                0             1
121         1       0                0             1
122         1       0                0             1
123         1       0                0             1
124         0       1                0             1
125         1       0                0             1
126         0       1                0             1
127         0       1                0             1
128         1       0                0             1
129         1       0                0             1
130         0       1                0             1
131         1       0                0             1
132         1       0                0             1
133         0       1                0             1
134         1       0                0             1
135         1       0                0             1
136         0       1                0             1
137         1       0                0             1
138         1       0                0             1
139         0       1                0             1
140         1       0                0             1
141         1       0                0             1
142         1       0                0             1
143         1       0                0             1
144         0       1                0             1
145         0       1                0             1
146         1       0                0             1
147         1       0                0             1
148         1       0                0             1
149         1       0                0             1
150         0       1                0             1
151         0       1                0             1
152         1       0                0             1
153         1       0                0             1
154         0       1                0             1
155         1       0                0             1
156         0       1                0             1
157         1       0                0             1
158         1       0                0             1
159         1       0                0             1
160         1       0                0             1
161         0       1                0             1
162         1       0                0             1
163         1       0                1             0
164         1       0                1             0
165         1       0                1             0
166         1       0                1             0
167         1       0                1             0
168         0       1                0             0
169         0       1                0             0
170         0       1                0             0
171         0       1                0             0
172         0       1                0             0
173         0       1                1             0
174         0       1                1             0
175         0       1                1             0
176         0       1                1             0
177         0       1                1             0
178         0       1                1             0
179         0       1                1             0
180         1       0                1             0
181         0       1                1             0
182         0       1                1             0
183         0       1                1             0
184         0       1                1             0
185         0       1                1             0
186         0       1                1             0
187         0       1                1             0
188         0       1                1             0
189         0       1                1             0
190         0       1                1             0
191         0       1                1             0
192         0       1                1             0
193         0       1                1             0
194         0       1                1             0
195         0       1                1             0
196         0       1                1             0
197         0       1                1             0
198         0       1                1             0
199         0       1                1             0
200         0       1                1             0
201         1       0                1             0
202         0       1                0             0
203         0       1                0             0
204         0       1                0             0
205         0       1                0             0
206         0       1                0             0
207         0       1                0             0
208         0       1                0             0
209         0       1                0             0
210         0       1                0             0
211         0       1                0             0
212         0       1                0             0
213         0       1                0             0
214         0       1                0             0
215         1       0                0             0
216         0       1                0             0
217         0       1                0             0
218         0       1                0             0
219         0       1                0             1
220         0       1                0             1
221         1       0                1             0
222         0       1                1             0
223         1       0                1             0
224         0       1                1             0
225         1       0                1             0
226         0       1                1             0
227         1       0                1             0
228         0       1                1             0
229         1       0                1             0
230         1       0                1             0
231         0       1                1             0
232         1       0                1             0
233         1       0                1             0
234         0       1                1             0
235         0       1                0             0
236         0       1                0             0
237         0       1                0             0
238         1       0                0             0
239         0       1                0             0
240         0       1                0             0
241         0       1                0             0
242         0       1                0             0
243         0       1                0             0
244         0       1                0             0
245         0       1                0             0
246         0       1                0             0
247         0       1                0             0
248         0       1                0             0
249         0       1                0             0
250         0       1                0             0
251         0       1                0             0
252         0       1                0             0
253         0       1                0             0
254         0       1                0             0
255         0       1                0             0
256         0       1                0             1
257         0       1                0             1
258         0       1                0             1
259         1       0                1             0
260         1       0                1             0
261         1       0                1             0
262         1       0                1             0
263         0       1                1             0
264         1       0                1             0
265         1       0                1             0
266         1       0                1             0
267         1       0                1             0
268         0       1                0             0
269         1       0                0             0
270         1       0                0             0
271         0       1                0             0
272         1       0                0             0
273         0       1                0             0
274         0       1                0             0
275         0       1                0             0
276         0       1                0             0
277         0       1                0             0
278         0       1                0             0
279         0       1                0             0
280         0       1                0             0
281         0       1                0             0
282         1       0                0             0
283         0       1                0             0
284         0       1                0             0
285         0       1                0             0
286         0       1                0             0
287         0       1                0             0
288         0       1                0             0
289         0       1                0             0
290         0       1                0             0
291         0       1                0             1
292         0       1                0             1
293         0       1                0             1
294         0       1                0             1
295         0       1                0             1
296         1       0                1             0
297         1       0                1             0
298         1       0                1             0
299         1       0                1             0
300         1       0                1             0
301         1       0                0             0
302         1       0                0             0
303         0       1                0             0
304         1       0                0             0
305         1       0                0             0
306         1       0                0             0
307         0       1                0             0
308         1       0                0             0
309         0       1                0             0
310         1       0                0             0
311         0       1                0             0
312         1       0                0             0
313         1       0                0             0
314         0       1                0             0
315         0       1                0             0
316         0       1                0             1
317         0       1                0             1
318         0       1                0             1
319         0       1                0             1
320         0       1                0             1
321         0       1                0             1
322         0       1                0             1
323         0       1                0             1
324         0       1                0             1
325         0       1                0             1
326         0       1                0             1
327         0       1                0             1
328         1       0                1             0
329         1       0                1             0
330         1       0                1             0
331         1       0                1             0
332         1       0                1             0
333         1       0                1             0
attr(,&quot;assign&quot;)
[1] 1 1 2 2
attr(,&quot;contrasts&quot;)
attr(,&quot;contrasts&quot;)$sex
[1] &quot;contr.treatment&quot;

attr(,&quot;contrasts&quot;)$species
[1] &quot;contr.treatment&quot;</code></pre>
<pre class="r"><code>#model.matrix(~sex+species-1, penguins_new)
penguins_new %&gt;% 
  group_by(sex) %&gt;% 
  summarise(means = mean(bill_volume))</code></pre>
<pre><code># A tibble: 2 × 2
  sex     means
  &lt;fct&gt;   &lt;dbl&gt;
1 female 11373.
2 male   14698.</code></pre>
<pre class="r"><code>lm(bill_volume~sex+0, penguins_new)</code></pre>
<pre><code>
Call:
lm(formula = bill_volume ~ sex + 0, data = penguins_new)

Coefficients:
sexfemale    sexmale  
    11373      14698  </code></pre>
</div>
<div id="recipes-package" class="section level3">
<h3>Recipes package</h3>
<p>The <code>recipes</code> package aims to make our data engineering
steps reproducible and easier for new data. The data engineering steps
would come after data cleaning. Suppose, for example, we wanted to
predict the <code>flipper_length_mm</code> as a function of the original
<code>penguin</code> dataset plus <code>bill_volume</code>. Using
<code>recipes</code> and starting with the original dataset:</p>
<pre class="r"><code>set.seed(16234)
# Put 80% of the data into the training set
penguins_split &lt;- initial_split(
  penguins %&gt;% filter(complete.cases(.)), prop = 0.8)
# now do the split
train_data &lt;- training(penguins_split)
test_data  &lt;- testing(penguins_split)

# start with the main ingredient
pengiun_recipe &lt;- recipe(flipper_length_mm~., data=train_data) %&gt;%
  # define any roles that need tweaking, I dont want year as predictor/outcome
  update_role(year, new_role = &quot;YEAR&quot;) %&gt;%
  # remove variables that have no variation
  step_zv(all_predictors()) %&gt;%
  step_mutate_at(all_nominal_predictors(), fn = as.factor) %&gt;%
  step_mutate(bill_volume = bill_length_mm * bill_depth_mm^2) %&gt;%
  step_center(all_numeric_predictors()) %&gt;%
  step_scale(all_numeric_predictors()) %&gt;%
  # expand the nominal variables as one-hot encoded variable
  step_dummy(all_nominal_predictors())

train_data_baked &lt;- pengiun_recipe %&gt;% 
    prep() %&gt;% 
    bake(train_data) 

test_data_baked &lt;- pengiun_recipe %&gt;% 
    prep() %&gt;% 
    bake(test_data) </code></pre>
<p>Just for fun:</p>
<pre class="r"><code>library(h2o)</code></pre>
<pre><code>
----------------------------------------------------------------------

Your next step is to start H2O:
    &gt; h2o.init()

For H2O package documentation, ask for help:
    &gt; ??h2o

After starting H2O, you can use the Web UI at http://localhost:54321
For more information visit https://docs.h2o.ai

----------------------------------------------------------------------</code></pre>
<pre><code>
Attaching package: &#39;h2o&#39;</code></pre>
<pre><code>The following objects are masked from &#39;package:lubridate&#39;:

    day, hour, month, week, year</code></pre>
<pre><code>The following objects are masked from &#39;package:data.table&#39;:

    hour, month, week, year</code></pre>
<pre><code>The following objects are masked from &#39;package:stats&#39;:

    cor, sd, var</code></pre>
<pre><code>The following objects are masked from &#39;package:base&#39;:

    &amp;&amp;, %*%, %in%, ||, apply, as.factor, as.numeric, colnames,
    colnames&lt;-, ifelse, is.character, is.factor, is.numeric, log,
    log10, log1p, log2, round, signif, trunc</code></pre>
<pre class="r"><code>h2o.init()</code></pre>
<pre><code>
H2O is not running yet, starting it now...

Note:  In case of errors look at the following log files:
    /var/folders/w4/c_w0jdx94pn2742c3xb8zgy40000gn/T//RtmpQ2dHoF/file186955b7c527f/h2o_rsettlag_started_from_r.out
    /var/folders/w4/c_w0jdx94pn2742c3xb8zgy40000gn/T//RtmpQ2dHoF/file186953f0c3ec5/h2o_rsettlag_started_from_r.err


Starting H2O JVM and connecting: ... Connection successful!

R is connected to the H2O cluster: 
    H2O cluster uptime:         4 seconds 22 milliseconds 
    H2O cluster timezone:       America/New_York 
    H2O data parsing timezone:  UTC 
    H2O cluster version:        3.42.0.2 
    H2O cluster version age:    2 months and 15 days 
    H2O cluster name:           H2O_started_from_R_rsettlag_ibf816 
    H2O cluster total nodes:    1 
    H2O cluster total memory:   3.54 GB 
    H2O cluster total cores:    10 
    H2O cluster allowed cores:  10 
    H2O cluster healthy:        TRUE 
    H2O Connection ip:          localhost 
    H2O Connection port:        54321 
    H2O Connection proxy:       NA 
    H2O Internal Security:      FALSE 
    R Version:                  R version 4.3.1 (2023-06-16) </code></pre>
<pre class="r"><code>train_h2o &lt;- as.h2o(train_data_baked)</code></pre>
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre class="r"><code>test_h2o  &lt;- as.h2o(test_data_baked)</code></pre>
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre class="r"><code>y &lt;- &quot;flipper_length_mm&quot;
x &lt;- setdiff(names(train_h2o), y)

automl_models_h2o &lt;- h2o.automl(
    x = x,
    y = y,
    training_frame   = train_h2o,
    max_runtime_secs = 600,
    nfolds           = 10
)</code></pre>
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre class="r"><code>automl_models_h2o@leaderboard</code></pre>
<pre><code>                                                model_id     rmse      mse
1    StackedEnsemble_AllModels_6_AutoML_1_20231011_72637 4.734668 22.41708
2 StackedEnsemble_BestOfFamily_6_AutoML_1_20231011_72637 4.765814 22.71298
3            GBM_grid_1_AutoML_1_20231011_72637_model_11 4.816655 23.20016
4    DeepLearning_grid_1_AutoML_1_20231011_72637_model_8 4.835694 23.38394
5   DeepLearning_grid_1_AutoML_1_20231011_72637_model_10 4.847529 23.49854
6            GBM_grid_1_AutoML_1_20231011_72637_model_18 4.861655 23.63569
       mae      rmsle mean_residual_deviance
1 3.683858 0.02392282               22.41708
2 3.701905 0.02402808               22.71298
3 3.753234 0.02428344               23.20016
4 3.746342 0.02442209               23.38394
5 3.796269 0.02450412               23.49854
6 3.786708 0.02447315               23.63569

[146 rows x 6 columns] </code></pre>
<pre class="r"><code># grab first model
best_model &lt;- automl_models_h2o@leaderboard %&gt;% 
  as_tibble() %&gt;%
  slice(1)

best_model</code></pre>
<pre><code># A tibble: 1 × 6
  model_id                        rmse   mse   mae  rmsle mean_residual_deviance
  &lt;chr&gt;                          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;                  &lt;dbl&gt;
1 StackedEnsemble_AllModels_6_A…  4.73  22.4  3.68 0.0239                   22.4</code></pre>
<pre class="r"><code>best_model_results &lt;- h2o.getModel(paste0(best_model[1]))


predictions &lt;- h2o.predict(best_model_results, newdata = test_h2o) %&gt;% 
  as.tibble() %&gt;% 
  bind_cols(test_data_baked %&gt;% select(flipper_length_mm, sex_male)) </code></pre>
<pre><code>Warning: `as.tibble()` was deprecated in tibble 2.0.0.
ℹ Please use `as_tibble()` instead.
ℹ The signature and semantics have changed, see `?as_tibble`.
This warning is displayed once every 8 hours.
Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
generated.</code></pre>
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre class="r"><code>predictions %&gt;%
  ggplot(aes(x=flipper_length_mm, y=predict)) +
  geom_point(aes(color=as_factor(sex_male))) +
  geom_segment(x = -180, y = -180, xend = 230, yend = 230, 
                     color = &quot;black&quot;) +
  theme(legend.position = &quot;bottom&quot;) + 
  expand_limits(x = c(180,230), y = c(180,230))</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/model_and_predict_h2o-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-model_and_predict_h2o-1">
Past versions of model_and_predict_h2o-1.png
</button>
</p>
<div id="fig-model_and_predict_h2o-1" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/model_and_predict_h2o-1.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<pre class="r"><code># just curious what the model looks like on the training data
predictions_train_data &lt;- h2o.predict(best_model_results, newdata = train_h2o) %&gt;% as.tibble() %&gt;% bind_cols(train_data_baked %&gt;% select(flipper_length_mm, sex_male)) </code></pre>
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |======================================================================| 100%</code></pre>
<pre class="r"><code>predictions_train_data %&gt;%
  ggplot(aes(x=flipper_length_mm, y=predict)) +
  geom_point(aes(color=as_factor(sex_male))) +
  geom_segment(x = -180, y = -180, xend = 230, yend = 230, 
                     color = &quot;black&quot;) +
  theme(legend.position = &quot;bottom&quot;) + 
  expand_limits(x = c(175,230), y = c(175,230))</code></pre>
<p><img src="figure/Week_8_forcats_recipes.Rmd/model_and_predict_h2o-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>
<button type="button" class="btn btn-default btn-xs btn-workflowr btn-workflowr-fig" data-toggle="collapse" data-target="#fig-model_and_predict_h2o-2">
Past versions of model_and_predict_h2o-2.png
</button>
</p>
<div id="fig-model_and_predict_h2o-2" class="collapse">
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/rsettlage/STAT5014_FALL2023/blob/0c7e5d934a67297b6f0b8626898d8449d9f9d0cf/docs/figure/Week_8_forcats_recipes.Rmd/model_and_predict_h2o-2.png" target="_blank">0c7e5d9</a>
</td>
<td>
rsettlage
</td>
<td>
2023-08-22
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="alert alert-warning">
<p>
<strong>Warning:</strong> The above code chunk cached its results, but
it won’t be re-run if previous chunks it depends on are updated. If you
need to use caching, it is highly recommended to also set
<code>knitr::opts_chunk$set(autodep = TRUE)</code> at the top of the
file (in a chunk that is not cached). Alternatively, you can customize
the option <code>dependson</code> for each individual chunk that is
cached. Using either <code>autodep</code> or <code>dependson</code> will
remove this warning. See the
<a href="https://yihui.name/knitr/options/#cache"
>knitr cache options</a> for more details.
</p>
</div>
</div>
<div id="python" class="section level3">
<h3>Python</h3>
<p>Not to be left out, ports to python exist for forcats – siuba, but
not for the recipes package. :(</p>
<p>The functions are identically named. The docs aren’t great. BUT, I
found <code>datar</code> which looks very promising:</p>
<p><a href="https://github.com/pwwang/datar"
class="uri">https://github.com/pwwang/datar</a></p>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.3.1 (2023-06-16)
Platform: aarch64-apple-darwin20 (64-bit)
Running under: macOS Monterey 12.4

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/New_York
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] h2o_3.42.0.2         rsample_1.2.0        recipes_1.0.8       
 [4] skimr_2.1.5          palmerpenguins_0.1.1 reticulate_1.32.0   
 [7] lubridate_1.9.2      forcats_1.0.0        stringr_1.5.0       
[10] dplyr_1.1.3          purrr_1.0.2          readr_2.1.4         
[13] tidyr_1.3.0          tibble_3.2.1         ggplot2_3.4.3       
[16] tidyverse_2.0.0      data.table_1.14.8    knitr_1.43          

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.0    timeDate_4022.108   farver_2.1.1       
 [4] bitops_1.0-7        RCurl_1.98-1.12     fastmap_1.1.1      
 [7] promises_1.2.1      digest_0.6.33       rpart_4.1.19       
[10] timechange_0.2.0    lifecycle_1.0.3     ellipsis_0.3.2     
[13] survival_3.5-5      magrittr_2.0.3      compiler_4.3.1     
[16] rlang_1.1.1         sass_0.4.7          tools_4.3.1        
[19] utf8_1.2.3          yaml_2.3.7          labeling_0.4.3     
[22] bit_4.0.5           curl_5.0.2          repr_1.1.6         
[25] workflowr_1.7.0     withr_2.5.0         nnet_7.3-19        
[28] grid_4.3.1          fansi_1.0.4         git2r_0.32.0       
[31] colorspace_2.1-0    future_1.33.0       globals_0.16.2     
[34] scales_1.2.1        MASS_7.3-60         cli_3.6.1          
[37] crayon_1.5.2        rmarkdown_2.24      generics_0.1.3     
[40] rstudioapi_0.15.0   future.apply_1.11.0 tzdb_0.4.0         
[43] cachem_1.0.8        splines_4.3.1       parallel_4.3.1     
[46] base64enc_0.1-3     vctrs_0.6.3         hardhat_1.3.0      
[49] Matrix_1.5-4.1      jsonlite_1.8.7      hms_1.1.3          
[52] bit64_4.0.5         listenv_0.9.0       gower_1.0.1        
[55] jquerylib_0.1.4     glue_1.6.2          parallelly_1.36.0  
[58] codetools_0.2-19    stringi_1.7.12      gtable_0.3.4       
[61] later_1.3.1         munsell_0.5.0       pillar_1.9.0       
[64] furrr_0.3.1         htmltools_0.5.6     ipred_0.9-14       
[67] lava_1.7.2.1        R6_2.5.1            rprojroot_2.0.3    
[70] evaluate_0.21       lattice_0.21-8      highr_0.10         
[73] png_0.1-8           httpuv_1.6.11       bslib_0.5.1        
[76] class_7.3-22        Rcpp_1.0.11         prodlim_2023.08.28 
[79] whisker_0.4.1       xfun_0.40           fs_1.6.3           
[82] pkgconfig_2.0.3    </code></pre>
</div>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
